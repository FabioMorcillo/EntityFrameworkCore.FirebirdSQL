version: '0.0.0.{build}'
image: Visual Studio 2017
configuration:
  - Release
environment:
  matrix:
  - name: FB 3.2
    fb_download: https://www.dropbox.com/s/lwn0gcywgpqt2bm/binarios.7z?dl=1
    fb_start: .\firebird.exe -a

shallow_clone: true
test: off
before_build:
  - ps: $baseDir = Resolve-Path .
build_script:
  - ps: $env:build_nuget = 'C:\Program Files\AppVeyor\BuildAgent\Tools\nuget.exe'
  - ps: $env:build_wix = 'C:\Program Files (x86)\WiX Toolset v3.11\bin'
after_build:
  - ps: mkdir "$baseDir\out" | Out-Null
  - ps: gci "$baseDir\out" | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }
before_test:
  - ps: $testsBaseDir = "$baseDir\EntityFrameworkCore.FirebirdSql.FunctionalTests"
  - ps: mkdir C:\firebirdefcore | Out-Null
  - ps: cd C:\firebirdefcore
  - ps: Start-FileDownload "$env:fb_download" | Out-Null
  - ps: 7z x ($env:fb_download -replace '.+/([^/]+)\?dl=1','$1')
  - ps: rmdir -Recurse .\embedded
  - ps: mv .\server\* .
  - ps: rmdir .\server

  - ps: iex $env:fb_start
  - ps: ni firebird.log -ItemType File | Out-Null
test_script:
  - ps: cd $testsBaseDir
  - ps: dotnet test EFCore.FirebirdSql.FunctionalTests.csproj -c $env:CONFIGURATION -f netcoreapp2.0 --no-build --no-restore
notifications:
- provider: GitHubPullRequest
  on_build_success: true
  on_build_failure: true
  on_build_status_changed: true
- provider: Email
  to:
  - ralms@ralms.net
  subject: EntityframeworkCore.FirebirdSql
  on_build_success: true
  on_build_failure: true
  on_build_status_changed: true
